@page "/admin/products"

@using Tionit.ShopOnline.Backoffice.Application.Queries.Produts;
@using Tionit.ShopOnline.Backoffice.Application.Queries.Produts.Models;
@using Tionit.ShopOnline.Backoffice.InteropServices
@using Tionit.Enterprise.Exceptions
@using Tionit.ShopOnline.Backoffice.Application.Commands.Products
@using Tionit.ShopOnline.Backoffice.Application.Commands.Products.Models
@using System.ComponentModel.DataAnnotations
@using Newtonsoft.Json

<style>
    #price-value > .k-widget.k-numerictextbox {
        width: 100%;
    }
</style>

<div class="kt-portlet">
    <div class="kt-portlet__head">
        <div class="kt-portlet__head-label">
            <span class="kt-portlet__head-icon">
                <i class="la la-dropbox"></i>
            </span>
            <h3 class="kt-portlet__head-title">
                Продукты
            </h3>
        </div>
        <div class="kt-portlet__head-toolbar">
            <div class="kt-portlet__head-actions">
                <button id="CreateButton" name="CreateButton" @onclick="@ShowCreateWindow" class="btn btn-info btn-elevate btn-elevate-air">
                    <i class="la la-plus"></i>  Добавить продукт
                </button>
            </div>
        </div>
    </div>
    <div class="kt-portlet__body">
        <TelerikGrid Class="product-grid" Data="@ProductList" TotalCount="@TotalCount" Height="500px" Pageable="true" Sortable="true"
                     FilterMode="GridFilterMode.FilterRow" OnRead="@OnGridNeedItems">
            <GridColumns>
                <GridColumn Field="Действие" Filterable="false" Width="170px">
                    <Template>
                        @{
                            <div class="dropdown actions-column">
                                <button class="btn btn-info actions-btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="la la-cog"></i> Действия
                                </button>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">
                                    <a id="EditAdmin" class="dropdown-item" @onclick="@UpdateProduct">
                                            <i class="la la-edit"></i> Редактировать
                                        </a>
                                        <a id="RemoveAdmin" class="dropdown-item" @onclick="@RemoveProduct">
                                            <i class="la la-trash"></i> Удалить
                                        </a>
                                </div>
                            </div>
                        }
                    </Template>
                </GridColumn>
                <GridColumn Field="@(nameof(ProductModel.Name))" Title="Название"/>
                <GridColumn Field="@(nameof(ProductModel.Price))" Title="Цена(₽)"/>
            </GridColumns>
        </TelerikGrid>
    </div>
</div>

<TelerikWindow Width="560px" Height="330px" Visible="@IsCreateMode">
    <WindowTitle>
        <strong><i class="la la-cube"> Добавление продукта</i></strong>
    </WindowTitle>
    <WindowActions>
        <WindowAction Name="Close" OnClick="@CloseCreateWindow" />
    </WindowActions>
    <WindowContent>
        <div class="p-2">
            <EditForm Model="@createProductUiModel">
                <DataAnnotationsValidator />

                <TelerikTextBox Label="Название" @bind-Value="@createProductUiModel.Name" @bind-Value:event="ValueChanged" Class="full-width" />
                <ValidationMessage For="@(() => createProductUiModel.Name)"></ValidationMessage>
                <div id="price-value" class="full-width">
                    <label style="margin-top: 1rem; margin-bottom: initial; color: rgba(0,0,0,0.38);">Цена</label>
                    <TelerikNumericTextBox @bind-Value="@createProductUiModel.Price" Class="full-width" />
                    <ValidationMessage For="@(() => createProductUiModel.Price)"></ValidationMessage>
                </div>
            </EditForm>
        </div>
        <div class="float-right p-2 mt-2">
            <button type="button" class="btn btn-outline-brand btn-elevate btn-elevate-air" @onclick="@CloseCreateWindow">Отмена</button>

            <button class="btn btn-success btn-elevate btn-elevate-air" @onclick="@CreateProduct" disabled="@(!IsSaveButtonEnabled)">Сохранить</button>
        </div>
    </WindowContent>
</TelerikWindow>
@using Microsoft.AspNetCore.Components

@inject UserSession CurrentUserSession
@inject NavigationManager NavigationManager

@if (hasLoaded)
{
    <CascadingValue Value="@this">
        @ChildContent
    </CascadingValue>
}
else
{
    <div class="kt-page-loader kt-page-loader--logo">
        <img alt="Logo" src="/img/logo.png" width="150" />
        <div class="kt-spinner kt-spinner--danger"></div>
    </div>
}

@code {
    private bool hasLoaded;

    [Parameter]
    public RenderFragment ChildContent { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !CurrentUserSession.IsLoaded)
        {
            await CurrentUserSession.LoadSession();

            if (CurrentUserSession.IsSessionStarted)
            {
                if (!NavigationManager.Uri.Contains("admin"))
                    NavigationManager.NavigateTo("/admin/admins");
            }
            else NavigationManager.NavigateTo("/");

            hasLoaded = true;
            StateHasChanged();
        }
    }
}